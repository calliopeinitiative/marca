{# Marca/FileBundle/Resources/views/layout.html.twig #}

{% extends '::base.html.twig' %}

{% block title %}{{ application_name }} {% if app.request.get('resource')=='1' %}Resources{% else %}Projects{% endif %}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link type="text/css" rel="stylesheet" href="{{ asset('bundles/marcahome/css/theme.bootstrap.css') }}">
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <!-- tablesorter plugin -->
    <script src="{{ asset('bundles/marcahome/js/jquery.tablesorter.min.js') }}"></script>
    <!-- tablesorter widget file - loaded after the plugin -->
    <script src="{{ asset('bundles/marcahome/js/jquery.tablesorter.widgets.min.js') }}"></script>
    <script language="javascript">
        $(document).ready(function()
        {


            $('#file_new_doc').click(function(){
                $('#file_modal').load('{{ course_path('file_new_modal', { 'resource': app.request.get('resource'), 'type': 'doc' }) }}');
                $('#file_modal').modal();
            });
            $('#file_new_link').click(function(){
                $('#file_modal').load('{{ course_path('file_new_modal', { 'resource': app.request.get('resource'), 'type': 'link' }) }}');
                $('#file_modal').modal();
            });
            $('#file_new_upload').click(function(){
                $('#file_modal').load('{{ course_path('file_upload', { 'resource': app.request.get('resource') }) }}');
                $('#file_modal').modal();
            });
            $( "li" ).hover(
                    function() {
                        $(".default").hide();$( ".default", this ).show();
                    }
            );

            $('.modal-body').css('max-height', function(index) {
                return $(window).height() * .90;
            });
            {% for file in files%}
            $('.edit_{{file.id}}').click(function(){
                $('#file_modal').load('{{ course_path('file_edit_modal', { 'id': file.id, 'resource': app.request.get('resource') }) }}').modal();
            });
            $('#upload_{{file.id}}').click(function(){
                $('#file_modal').load('{{ course_path('review_upload', { 'resource' : '0',  'fileid': file.id }) }}').modal();
            });
            $('#file_show_{{file.id}}').click(function(){
                $('#file_modal').load('{{ course_path('file_show_modal', { 'id': file.id, 'resource': app.request.get('resource'),'source':'edit_modal'}) }}').modal();
            });
            {% endfor %}
            $('.file-wrapper').css('max-height', function(index) {
                return $(window).height()* .88;
            });
            $.extend($.tablesorter.themes.bootstrap, {
                table      : 'table',
                header     : 'bootstrap-header', // give the header a gradient background
                footerRow  : '',
                footerCells: '',
                icons      : '', // add "icon-white" to make them white; this icon class is added to the <i> in the header
                sortNone   : 'glyphicon glyphicon-sort',
                sortAsc    : 'glyphicon glyphicon-arrow-up',     // includes classes for Bootstrap v2 & v3
                sortDesc   : 'glyphicon glyphicon-arrow-down', // includes classes for Bootstrap v2 & v3
                active     : '', // applied when column is sorted
                hover      : '', // use custom css here - bootstrap class may not override it
                filterRow  : '', // filter row class
                even       : '', // odd row zebra striping
                odd        : ''  // even row zebra striping
            });
            // call the tablesorter plugin and apply the uitheme widget
            $("table").tablesorter({
                theme : "bootstrap",
                widthFixed: true,
                headerTemplate : '{content} {icon}', // new in v2.7. Needed to add the bootstrap icon!
                widgets : [ "uitheme"]
            });
            $( "tr" ).hover(
                    function() {
                        $(".file-menu").hide();$( ".file-menu", this ).toggle();
                    }
            );
            $( "i" ).hover(
                    function() {
                        $(".tablesorter-icon").show();$( ".tablesorter-icon", this ).toggle();
                    }
            );
            $('.file_name').bind('focus', function(){ $(".file-menu").hide();$(this).parent().children("div").children("div").toggle(); });
            // count files
            var count_hidden = $('#file_list tr.hidden').length;
            var count_displayed = $('#file_list tr').length -2;
            var count = count_displayed - count_hidden;
            var count_text = '';
            if (count > 1) {count_text = ' ' + count + ' files found';$('p.file_count').append(count_text);}

            // url creation for roll file listing from esi fragment in sidebar
            $('a.roll').click(function() {
                var id = $(this).data("id");
                var index = $(this).data("index");
                var url = "{{ course_path('file_listbyuser', { 'userid': 'id', 'resource': 0}) }}";
                url = url.replace("id", id);
                $(this).attr("href", url).click();
            });

            //add current-filter to active items
            {% if app.request.get("project") %}
            var project_index = 'a[data-project-index=' + '{{ app.request.get("project") }}' + ']';
            $(project_index).addClass('current-filter');
            {% endif %}
        });
    </script>
{% endblock %}

{% block coursenav %}
    {{ render_esi(controller('MarcaCourseBundle:Course:createCoursenav', { 'courseid': app.request.get('courseid') })) }}
{% endblock %}

{% block subnav %}
    {% if app.request.get('resource')=='0' %}
    {{ render_esi(controller('MarcaFileBundle:File:createSubnav', { 'courseid': app.request.get('courseid')})) }}
    {% endif %}
{% endblock %}

{% block sidebar %}
    {% if app.request.get('resource')=='0' %}
    {{ render_esi(controller('MarcaFileBundle:File:createProjects_sidebar', { 'courseid': app.request.get('courseid'),
    'resource': app.request.get('resource')})) }}
    {% else %}
    {{ render_esi(controller('MarcaFileBundle:File:createResources_sidebar', { 'courseid': app.request.get('courseid'),
    'resource': app.request.get('resource')})) }}
    {% endif %}
{% endblock %}
