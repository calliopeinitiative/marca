{# Marca/FileBundle/Resources/views/layout.html.twig #}

{% extends '::base.html.twig' %}
{% block title %}{{ application_name }} {% if app.request.get('resource')=='1' %}Resources{% else %}Projects{% endif %}{% endblock %}

{% block stylesheets %}{{ parent() }}{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script language="javascript">
        $(document).ready(function()
        {
            $('#file_new_doc').click(function(){
                $('#file_modal').load('{{ course_path('file_new_modal', { 'fileid':'0','resource': app.request.get('resource'), 'tag': app.request.get('tag'),'type': 'doc' }) }}');
                $('#file_modal').modal();
            });
            $('#file_new_link').click(function(){
                $('#file_modal').load('{{ course_path('file_new_modal', { 'fileid':'0','resource': app.request.get('resource'), 'tag': app.request.get('tag'),'type': 'link' }) }}');
                $('#file_modal').modal();
            });
            $('#file_new_upload').click(function(){
                $('#file_modal').load('{{ course_path('file_upload', { 'resource': app.request.get('resource'),  'tag': app.request.get('tag') }) }}');
                $('#file_modal').modal();
            });
        });
    </script>
{% endblock %}

{% block subnav %}
    {%include 'MarcaCourseBundle::subnav.html.twig' %}
{% endblock %}

{% block sidebar %}

    <h1>{% if app.request.get('resource')=='1' %}Resources{% else %}Projects{% endif %}</h1>

    {% if app.request.attributes.get('_route') == 'file_list'%}
        {# check to see if projects are in the current course  #}
        {% for project in projects if project.course.id == app.request.get('courseid') %}
            {# if for resources (only instructor can post to resources)  #}
            {% if (app.request.get('resource')=='0' or role=='2') and loop.first %}
                <div class="btn-group">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                        Create
                        <i class="glyphicon glyphicon-pencil glyphicon-white"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a id='file_new_doc' title='Create new document' href='javascript:void(0);'><i class="glyphicon glyphicon-edit"></i> Document</a></li>
                        <li><a id='file_new_upload' title='Upload document' href="javascript:void(0);"><i class="glyphicon glyphicon-upload"></i> Upload</a></li>
                        <li><a id='file_new_link' title='Create new link' href="javascript:void(0);"><i class="glyphicon glyphicon-adjust"></i> Link</a></li>
                    </ul>
                </div>
            {% endif %}
    {% else %}
    {% endfor %}

        {% if app.request.get('resource')=='0' %}
            <hr class="marca-spacer" />

            <li><a class="project-sidebar {% if app.request.get('scope')=='mine' and app.request.get('tag')!='3' %}current-filter{% endif %}" href="{{ course_path('file_list', { 'project': 'recent', 'scope': 'mine', 'user': '0', 'resource': app.request.get('resource'), 'tag': '0', 'userid': '0' }) }}">My Files</a></li>
            <li><a class="project-sidebar {% if app.request.get('tag')=='3' %}current-filter{% endif %}" href="{{ course_path('file_list', { 'project': 'recent', 'scope': 'mine', 'user': '0', 'resource': app.request.get('resource'), 'tag': '3', 'userid': '0' }) }}">My Reviews</a></li>
            <li><a class="project-sidebar {% if app.request.get('scope')=='all' %}current-filter{% endif %}" href="{{ course_path('file_list', { 'project': 'recent', 'scope': 'all', 'user': '0', 'resource': app.request.get('resource'), 'tag': '0', 'userid': '0'}) }}">Shared Files</a></li>

            {# Roll for Find by user  #}
            <li class="dropdown"><a href="javascript:void(0);" role="button" class="project-sidebar {% if app.request.get('scope')=='byuser' %}current-filter{% endif %}" data-toggle="dropdown" id="findByAuthor">{% if app.request.get('scope')=='byuser' %}Files by {{ byuser.firstname|title }} {{ byuser.lastname|title }}{% else %}Files By Author{% endif %}<b class="caret" style="margin-left:6px;"></b></a>
                <ul class="dropdown-menu" role="menu" aria-labelledby="findByAuthor">
                    {% for roll in roll %}
                        <li><a data-index="{{loop.index}}" data-id='{{roll.userid}}' data-project='{{app.request.get('project')}}' data-tag='{{app.request.get('tag')}}' href="{{ course_path('file_list', { 'project': app.request.get('project'), 'scope': 'byuser', 'user': loop.index,'resource': app.request.get('resource'), 'tag': app.request.get('tag'), 'userid': roll.userid }) }}">{{roll.firstname}} {{roll.lastname}}</a></li>
                    {% endfor %}
                </ul></li>
            {% if byuser %}
                        {% for roll in roll %}
                            {% if loop.index == app.request.get('user') + 1 and app.request.get('tag')!='3' %}
                            <li><a data-index="{{loop.index}}" data-id='{{roll.userid}}' data-project='{{app.request.get('project')}}' data-tag='{{app.request.get('tag')}}' href="{{ course_path('file_list', { 'project': app.request.get('project'), 'scope': 'byuser', 'user': loop.index,'resource': app.request.get('resource'), 'tag': app.request.get('tag'), 'userid': roll.userid }) }}">{{roll.firstname|title}} {{roll.lastname|title}}<i class="glyphicon glyphicon-chevron-right"></i></a></li>
                            {% endif %}
                            {% if loop.index == app.request.get('user') - 1 and app.request.get('tag')!='3' %}
                            <li><a class='' data-index="{{loop.index}}" data-id='{{roll.userid}}' data-project='{{app.request.get('project')}}' data-tag='{{app.request.get('tag')}}' href="{{ course_path('file_list', { 'project': app.request.get('project'), 'scope': 'byuser', 'user': loop.index,'resource': app.request.get('resource'), 'tag': app.request.get('tag'), 'userid': roll.userid }) }}"><i class="glyphicon glyphicon-chevron-left"></i>{{roll.firstname|title}} {{roll.lastname|title}}</a></li>
                        {% endif %}
                        {% endfor %}
            {% endif %}
        {% endif %}

        <hr class="marca-spacer" />

        {# Projects  Find #}
        {% if app.request.get('resource')=='0' %}
            <li><a class="project-sidebar {% if active_project == 0 %}current-filter{% endif %}" href="{{ course_path('file_list', { 'project': 'recent', 'scope': app.request.get('scope'), 'user': app.request.get('user'), 'resource': app.request.get('resource'), 'tag': app.request.get('tag'), 'userid': app.request.get('userid') }) }}">
                    All Folders </a></li>
        {%else%}
        {% endif %}
        {% for project in projects %}
            <li>
                <a title='{% if app.request.get('resource')=='1' %}{{ project.course.name }}: {%endif%}{{ project.name }}' class="project-sidebar {% if active_project == project.id %}current-filter{% endif %} margin-left-medium" href="{{ course_path('file_list', { 'project': project.id, 'scope': app.request.get('scope'), 'user': app.request.get('user'), 'resource': app.request.get('resource'), 'tag': app.request.get('tag'), 'userid': app.request.get('userid') }) }}">
                    {% if app.request.get('resource')=='1' and project.course.name!=app.session.get('course') %}{{ project.course.name }}: {%endif%}{{ project.name }}</a>
            </li>
        {% endfor %}



        {# Labels  Find #}
        {% if app.request.get('project') == 'recent' and app.request.get('resource')!=0 %}
        {% else %}
            <hr class="marca-spacer" />
            <li>
                <a href="{{ course_path('file_list', { 'project': app.request.get('project'), 'scope': app.request.get('scope'), 'user': app.request.get('user'), 'resource': app.request.get('resource'), 'tag':'0', 'userid': app.request.get('userid') }) }}" class="project-sidebar {% if app.request.get('tag')=='0' %}current-filter{% endif %}">All Labels</a></li>
            {% for tag in tags %}
                <li>
                    <a href="{{ course_path('file_list', { 'project': app.request.get('project'), 'scope': app.request.get('scope'), 'user': app.request.get('user'), 'resource': app.request.get('resource'), 'tag': tag.id, 'userid': app.request.get('userid') }) }}" class="project-sidebar {% if app.request.get('tag')== tag.id %}current-filter{% endif %} margin-left-medium">
                        {{ tag.name }}</a></li>
            {% endfor %}
        {% endif %}
    {% endif %}

    {% if role == '2' and app.request.get('resource')==0 %}

        <hr class="marca-spacer" />

        <li><a class="project-sidebar" href="{{ course_path('file_release_all') }}">Release Hidden Reviews</a></li>
        <li><a id="sort_filter_toggle" class="project-sidebar" href="javascript:void(0);">Advanced Sort/Filter</a></li>

    {% endif %}

{% endblock %}